# 样本多样性分析工具参数说明

## 1. 基础多样性分析器 (diversity_analyzer.py)

### 状态多样性参数

| 参数名                 | 计算方式                                       | 作用                 | 理想值  | 说明                          |
| :--------------------- | :--------------------------------------------- | :------------------- | :------ | :---------------------------- |
| **state_novelty**      | `len(unique_states) / total_samples`           | 衡量分片内新状态比例 | 0.8-1.0 | 越高说明分片内重复越少        |
| **transition_novelty** | `len(unique_transitions) / total_samples`      | 衡量策略变化多样性   | 0.8-1.0 | 状态转移=(状态,动作,下一状态) |
| **recent_diversity**   | `len(set(recent_states)) / len(recent_states)` | 避免局部重复采集     | 0.7-1.0 | 最近5000个状态的多样性        |

### 位置多样性参数

| 参数名                | 计算方式                      | 作用             | 理想值  | 说明                   |
| :-------------------- | :---------------------------- | :--------------- | :------ | :--------------------- |
| **position_coverage** | `len(visited_positions) / 64` | 棋盘位置探索程度 | 0.9-1.0 | 64个位置中被访问的比例 |
| **position_entropy**  | `-∑ p(i) * log(p(i))`         | 位置访问均匀度   | 3.5-4.0 | 越高说明落子分布越均匀 |
| **rare_positions**    | `sum(visits == 1) / 64`       | 冷门位置探索程度 | 0.1-0.3 | 鼓励探索不常访问的位置 |

### 游戏进程多样性参数

| 参数名                  | 计算方式                              | 作用             | 理想值  | 说明                         |
| :---------------------- | :------------------------------------ | :--------------- | :------ | :--------------------------- |
| **phase_balance**       | `1 - (⎮opening-0.3⎮ + ⎮endgame-0.3⎮)` | 游戏阶段分布平衡 | 0.8-1.0 | 理想:开局30%,中局40%,残局30% |
| **stone_entropy**       | `-∑ p(count) * log(p(count))`         | 棋局规模多样性   | 3.5-4.0 | 覆盖空盘到满盘各种规模       |
| **game_length_entropy** | `-∑ p(length) * log(p(length))`       | 对局时长多样性   | 2.0-3.0 | 短、中、长各种时长对局       |

### 综合评分

| 评分项         | 权重 | 计算方式                                                     | 总分  |
| :------------- | :--- | :----------------------------------------------------------- | :---- |
| **状态多样性** | 40分 | `state_novelty×15 + transition_novelty×15 + recent_diversity×10` | 100分 |
| **位置多样性** | 30分 | `position_coverage×10 + position_entropy×10 + rare_positions×10` |       |
| **进程多样性** | 30分 | `phase_balance×10 + stone_entropy×10 + game_length_entropy×10` |       |

------

## 2. 全局多样性分析器 (global_diversity_analyzer.py)

### 全局核心参数

| 参数名                         | 计算方式                                     | 作用             | 理想值  | 说明                     |
| :----------------------------- | :------------------------------------------- | :--------------- | :------ | :----------------------- |
| **cross_shard_duplicate_rate** | `1 - (global_unique_states / total_samples)` | 跨分片重复程度   | <0.2    | 越低说明分片间重复越少   |
| **global_state_novelty**       | `len(global_unique_states) / total_samples`  | 真正的新状态比例 | 0.8-1.0 | 考虑所有分片的全局新颖性 |
| **global_unique_states**       | 所有分片唯一状态总数                         | 总唯一状态数量   | -       | 数据集真实规模指标       |

### 分片贡献参数

| 参数名                  | 计算方式                                 | 作用           | 说明                 |
| :---------------------- | :--------------------------------------- | :------------- | :------------------- |
| **new_states_in_shard** | 本分片中的全新状态数                     | 衡量分片贡献度 | 相对于之前所有分片   |
| **novelty_rate**        | `new_states_in_shard / samples_in_shard` | 分片采集效率   | 分片内真正新状态比例 |

### 输出文件说明

| 文件名称                         | 包含内容             | 主要用途         |
| :------------------------------- | :------------------- | :--------------- |
| **sample_diversity_report.csv**  | 各分片内部多样性指标 | 评估单个分片质量 |
| **global_diversity_summary.csv** | 全局汇总统计         | 了解整体数据质量 |
| **shard_novelty_details.csv**    | 各分片贡献详情       | 分析采集效率趋势 |

------

## 3. 质量等级标准

| 分数范围 | 等级         | 说明                   | 建议                   |
| :------- | :----------- | :--------------------- | :--------------------- |
| 80-100分 | **非常多样** | 样本覆盖全面，重复很少 | 适合直接用于训练       |
| 65-79分  | **比较多样** | 样本多样性良好         | 可以用于训练，效果较好 |
| 50-64分  | **一般多样** | 样本多样性一般         | 可能需要更多数据       |
| <50分    | **缺乏多样** | 样本重复严重           | 需要重新设计采集策略   |

------

## 4. 关键指标解读指南

### 重点关注指标：

- **跨分片重复率** > 30% → 采集策略需要调整
- **全局状态新颖性** < 70% → 数据多样性不足
- **位置覆盖率** < 80% → 棋盘探索不充分
- **阶段平衡性** < 0.7 → 游戏阶段分布不均

### 采集效率分析：

- 前期分片 novelty_rate 高 → 采集有效
- 后期分片 novelty_rate 明显下降 → 接近饱和
- 所有分片 novelty_rate 都低 → 采集策略有问题